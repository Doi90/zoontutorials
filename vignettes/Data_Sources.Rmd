---
title: "Data Sources"
output:
  html_document:
    css: zoon.css
    toc: yes
    toc_float:
      collapsed: false
      toc_depth: 4
    theme: lumen
bibliography: bibliography.bib
csl: Methods.csl    
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Data Sources}
  %\VignetteEncoding{UTF-8}
---

```{r knitr_options, eval=TRUE, echo=FALSE, warning=FALSE, message=FALSE}
# set up knitr options
knitr::opts_chunk$set(message = FALSE,
               warning = FALSE,
               fig.align = 'center',
               dev = c('png'),
               cache = TRUE,
               comment = NA)
```

```{r Library, echo=FALSE, message=FALSE, warning=FALSE}
library(zoon)
```

<hr>

## Introduction

Normally the first step in species distribution modelling is sourcing your species observation records (presence-only, presence-absence, or abundance) and environmental data (such as bioclimatic variables or vegetation maps) in the form of rasters. In some instances we might be using data we recorded ourselves, other times we might want to use data from public repositories, or even a combination of the two. There are multiple sources of data available, and you can access many of them with `zoon` through R. 

Using the `GetModuleList()` command we can see all of the `Occurrence` modules under the `$occurrence` sub-heading. We can also view the `Covariate` modules under the `$covariate` sub-heading. This tutorial will guide you through accessing some of these data sources within a `zoon` `workflow()`. 

```{r Module_List, eval=TRUE}
modules <- GetModuleList()
modules$occurrence            # subset for the sake of screen space
modules$covariate
```

<hr>

## Example data

`zoon` comes with several examle dataset modules that we can use. These pre-loaded datasets are useful examples for experimenting with `zoon` modules, or as test datasets when building new modules of your own. 

For example, we could choose to fit a model to the Carolina wren data using the `CarolinaWrenPO` or `CarolinaWrenPA` occurrence modules (presence-only and presence-absence, respectively) with the `CarolinaWrenRasters` covariate module. 

```{r Workflow, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
Carolina_Wren_Workflow <- workflow(occurrence = CarolinaWrenPO,
                                   covariate = CarolinaWrenRasters,
                                   process = NoProcess,
                                   model = NullModel,
                                   output = PrintMap)
```

```{r HTML_Output_1, echo=FALSE, fig.align='center', fig.height=7, fig.width=7}
# force the htmlwidget to render in the vignette
Output(Carolina_Wren_Workflow)
```

<hr>

## Our own data

SDMs are commonly fit to datasets we have collected ourselves, and `zoon` has modules to help us load them. The two modules of interest here are `LocalOccurrenceData` for our observation records and `LocalRaster` for our raster-based data.

To ensure that all datasets loaded in to a `zoon` `workflow` are compatible with the `model` modules, the `LocalOccurrenceData` module requires our data to be either .csv/.xlsx/.tab or /.xlsx files with a strict structure. The first and second columns are the `longitude` and `latitude` values (in that order), and the third column is the `value` of the observation (0 for absence, 1 for presence, and an integer for abundance data). If your coordinate system is not latitude/longitude then you can supply an optional fourth column called `CRS` that contains the PROJ.4 code for your coordinate system (e.g. `+init=epsg:27700` for easting/northing data for the UK). If no `CRS` column is supplied then latitude/longitude is assumed. 

To use the `LocalOccurrenceData` module you call `occurrence` in your `workflow` like this:

```{r LocalOccurrence, eval=FALSE}
occurrence = LocalOccurrenceData(filename = "myData.csv",         # File path to your data file
                                 occurrenceType = "presence",     # The type of data you have
                                 columns = c(long = "longitude",  # The names of the columns in 
                                             lat = "latitude",    #     your .csv that much the 
                                             value = "value"),    #     required columns
                                 externalValidation =  FALSE)     # Only required if validation
                                                                  #     data is set up externally
```

Raster data loaded into a `workflow` using `LocalRaster` also follows a set format, but it is a simpler process than for occurrence data. This module reads in either a single raster or raster-stack, or a list or vector of rasters and creates a raster-stack. You can find the set of allowed formats for loading rasters by looking at `?writeRasters`.

To use this module you call the `covariate` module like this:

```{r LocalRaster, eval=FALSE}
covariate = LocalRaster(rasters = c("myRaster1",     # Filepath to a raster
                                    "myRaster2"))    # Filepath to a second raster

covariate = LocalRaster(rasters = "myRasterStack")   # A RasterStack object already loaded
```

<hr>

## Online repositories

Sometimes we may want to source our `occurrence` and/or `covariate` data from online sources. Some modules of interest for this aim are `SpOcc`, `Bioclim`, `Bioclim-future`, and `NCEP`.

The `SpOcc` module is used to obtain species occurrence records from a selection of online databases, including: GBIF, BISON, iNat, eBird, Ecoengine, and AntWeb. We can call this module like this:

```{r SpOcc, eval=FALSE}
occurrence = SpOcc(species = "SpeciesName",   # Species scientific name
                   extent = c(-1, 0, 51, 52), # Coordinates for the extent of the region
                   databases = "gbif",        # List of data bases to use
                   type = "presence",         # Type of data you want
                   limit = 10000)             # A maximum limit of records to obtain
```

The `Bioclim` module obtains bioclimatic variables from WorldClim. This data is available at various resolutions (2.5, 5, or 10 minutes), and there are 19 available variables. We can call this module like this:

```{r Bioclim, eval=FALSE}
covariate = Bioclim(extent = c(-180, 180, -90, 90), # Coordinates for the extent of the region
                    resolution = 10,                # Required resolution
                    layers = 1:5)                   # Variables we want (between 1-19)
```

We can also obtain these bioclimatic variables for predictions of future climate using the `Bioclim_future` module. We can find more information about different scenarios used to predict future climates [here](https://en.wikipedia.org/wiki/Representative_Concentration_Pathways) and [here](https://en.wikipedia.org/wiki/General_circulation_model). We can call this `module` like this:

```{r Bioclim_future, eval=FALSE}
covariate = Bioclim_future(extent = c(-10, 10, 45, 65),  # Coordinates of the extent of the region
                           resolution = 10,              # Resolution of the data
                           layers = 1:19,                # Required Bioclim variables
                           rcp = 45,                     # Representative Concentration Pathways
                           model = "AC",                 # General Circulation Models
                           year = 70)                    # Time period for the prediction
```

The `NCEP` module obtains environmental data from the National Centers for Environmental Prediction. We can call this module like this:

```{r NCEP, eval=FALSE}
covariate = NCEP(extent = c(-5, 5, 50, 60),     # Coordinates of the extent of the region
                 variables = "hgt",             # Character cevtor of variables of interest
                 status.bar = FALSE)            # Show a status bar of download progress?
```

<hr>

## Example

Now that we've seen the different ways of obtaining data in `zoon`, lets see an example. Here we obtain presence-only data for the brown bear, *Ursus arctos*, in North America from GBIF, and bioclimatic variables from Wordclim.

```{r Ursus_arctos, eval=TRUE, message=FALSE, warning=FALSE}
Ursus_arctos_online <- workflow(occurrence = SpOcc(species = "Ursus arctos",
                                              extent = c(-175, -65, 20, 75),
                                              databases = "gbif",
                                              type = "presence"),
                                covariate = Bioclim(extent = c(-175, -65, 20, 75),
                                               resolution = 10,
                                               layers = 1:19),
                                process = Chain(StandardiseCov, Background(1000)),
                                model = MaxNet,
                                output = InteractiveOccurrenceMap)
```

```{r HTML_Output_2, echo=FALSE, fig.align='center', fig.height=7, fig.width=7}
# force the htmlwidget to render in the vignette
Output(Ursus_arctos_online)
```

<hr>
